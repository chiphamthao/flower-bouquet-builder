{% extends "layout.html" %} {% block content %}
<!-- jQuery UI Rotatable plugin -->
<script src="{{ url_for('static', filename='assemble.js') }}"></script>
<script src="{{ url_for('static', filename='final.js') }}"></script>
<script>
  let current_selections = {{current_selections|tojson}}
  let canvas_flowers = {{canvas_flowers|tojson}}
  let hasError = {{hasError|tojson}}
  let remaining = {{remaining|tojson}}
</script>

<div class="content">
  <h1 class="page-title" style="color: #4a7a4a">Assemble Your Bouquet</h1>
  <p class="page-subtitle">
    Using what you have learned from the lessons, choose your flowers, fillers,
    and greens to create a full bouquet
  </p>

  <h2 class="section-title">Choose your selection</h2>
  <div class="flower-grid">
    <!-- Row 1 -->
    <div
      class="flower-item"
      draggable="true"
      data-type="focal"
      data-name="rose"
    >
      <img src="/static/images/rose.png" alt="Rose" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="focal"
      data-name="sunflower"
    >
      <img src="/static/images/sunflower.png" alt="Sunflower" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="focal"
      data-name="daisy"
    >
      <img src="/static/images/daisy.png" alt="Daisy" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="secondary"
      data-name="tulip"
    >
      <img src="/static/images/tulip.png" alt="Tulip" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="focal"
      data-name="lily"
    >
      <img src="/static/images/lily.png" alt="Lily" />
    </div>

    <!-- Row 2 (Fillers) -->
    <div
      class="flower-item"
      draggable="true"
      data-type="filler"
      data-name="Babysbreath"
    >
      <img src="/static/images/babys-breath.png" alt="Baby's Breath" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="secondary"
      data-name="waxflower"
    >
      <img src="/static/images/waxflower.webp" alt="Waxflower" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="filler"
      data-name="statice"
    >
      <img src="/static/images/statice.webp" alt="Statice" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="filler"
      data-name="dustyMiller"
    >
      <img src="/static/images/dustymiller.png" alt="Dusty Miller" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="greens"
      data-name="eucalyptus"
    >
      <img src="/static/images/eucalyptus.png" alt="Eucalyptus" />
    </div>

    <!-- Row 3 - Greens -->
    <div
      class="flower-item"
      draggable="true"
      data-type="greens"
      data-name="ming-fern"
    >
      <img src="/static/images/ming-fern.jpg" alt="Ming Fern" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="greens"
      data-name="leatherLeaf"
    >
      <img src="/static/images/leatherleaf.png" alt="Leather Leaf" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="greens"
      data-name="salal"
    >
      <img src="/static/images/salal.jpg" alt="Salal" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="greens"
      data-name="ruscus"
    >
      <img src="/static/images/ruscus.png" alt="Ruscus" />
    </div>
    <div
      class="flower-item"
      draggable="true"
      data-type="greens"
      data-name="treeFern"
    >
      <img src="/static/images/treefern.png" alt="Tree Fern" />
    </div>
  </div>

  <h2 class="section-title">Drag and drop your final selection</h2>
  <div class="drop-zones">
    <div class="drop-zone-container">
      <div class="drop-zone-label">Focal</div>
      <div class="drop-zone" data-type="focal"></div>
    </div>
    <div class="drop-zone-container">
      <div class="drop-zone-label">Secondary</div>
      <div class="drop-zone" data-type="secondary"></div>
    </div>
    <div class="drop-zone-container">
      <div class="drop-zone-label">Filler</div>
      <div class="drop-zone" data-type="filler"></div>
    </div>
    <div class="drop-zone-container">
      <div class="drop-zone-label">Greens</div>
      <div class="drop-zone" data-type="greens"></div>
    </div>
  </div>

  <div class="bouquet-check">
    <button
      id="check-bouquet"
      style="font-family: Indie Flower, sans-serif"
      class="check-button"
    >
      Check your bouquet
    </button>
    <div class="check-results">
      <div class="check-item">
        <span class="check-label" style="font-family: Indie Flower, sans-serif"
          >Focal Flower</span
        >
        <span class="validation-indicator"></span>
      </div>
      <div class="check-item">
        <span class="check-label" style="font-family: Indie Flower, sans-serif"
          >Secondary Flower</span
        >
        <span class="validation-indicator"></span>
      </div>
      <div class="check-item">
        <span class="check-label" style="font-family: Indie Flower, sans-serif"
          >Filler</span
        >
        <span class="validation-indicator"></span>
      </div>
      <div class="check-item">
        <span class="check-label" style="font-family: Indie Flower, sans-serif"
          >Greens</span
        >
        <span
          class="validation-indicator"
          style="font-family: Indie Flower, sans-serif"
        ></span>
      </div>
    </div>
    <div
      class="validation-message"
      style="font-family: Indie Flower, sans-serif"
    ></div>
  </div>

  <div class="palette-canvas">
    <!-- Palette (populated by JS) -->
    <aside class="flower-palette" style="font-family: Indie Flower, sans-serif">
      <h2>Flower Palette</h2>
      <div id="palette" class="flower-sidebar">
        <!-- JS will inject your selected flowers here -->
      </div>
    </aside>

    <!-- Canvas -->
    <section class="canvas-area" style="font-family: Indie Flower, sans-serif">
      <h2>Your Canvas</h2>
      <div id="canvas" class="drop-zone-canvas"></div>
    </section>
  </div>

  <div class="back_next mt-4">
    <div class="row justify-content-between">
      <div class="col-auto">
        <a href="/buildit_quiz2" class="btn btn-outline-primary"
          >Previous Question</a
        >
      </div>
      <div class="col-auto" style="font-family: Indie Flower, sans-serif">
        <a href="/final" class="btn btn-primary">Finish</a>
      </div>
    </div>
  </div>
</div>
<script>
  async function submitScoreThenGo() {
    // Read the score from the on-screen text
    const scoreText = document.getElementById("score");
    if (!scoreText) {
      window.location.href = "/final"; // fallback
      return;
    }

    const score = parseInt(scoreText.textContent.match(/\d+/)[0]);

    await fetch("/submit_assemble_score", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ score }),
    });

    window.location.href = "/final";
  }
</script>
{% endblock %}
