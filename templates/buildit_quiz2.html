{% extends "layout.html" %}
{% block title %}Build-It! Quiz 2{% endblock %}

{% block content %}
<style>

  #check-btn{
    margin-top: 50px;
    margin-bottom: 30px;
  }

  .selectable-img {
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color 0.2s ease;
    max-height: 120px;
  }

  .selected {
    border-color: black;
  }

  .feedback {
    text-align: center;
    font-size: 1.1em;
    font-weight: bold;
    margin-top: 10px;
    font-family: 'Indie Flower', sans-serif;
  }

  .correct {
    color: #3b8c3b;
  }

  .incorrect {
    color: #c02e2e;
  }

  .lesson-title{
    margin-top: 20px;
  }
</style>

<h1 class="lesson-title" style="color: #4a7a4a;">Build-It!</h1>

<!-- Question 1 -->
<p class="lesson-subtitle">
  You are using <img src="{{ url_for('static', filename='images/rose.png') }}" style="height: 70px; vertical-align: middle;"> in a bouquet, which flower is similar in texture?
</p>
<div class="row justify-content-center mb-2" id="row1">
  <img src="{{ url_for('static', filename='images/Dahlia.png') }}" class="selectable-img mx-1" data-row="1" data-index="0">
  <img src="{{ url_for('static', filename='images/Sunflower.png') }}" class="selectable-img mx-1" data-row="1" data-index="1">
  <img src="{{ url_for('static', filename='images/solidago.webp') }}" class="selectable-img mx-1" data-row="1" data-index="2">
  <img src="{{ url_for('static', filename='images/craspedia.webp') }}" class="selectable-img mx-1" data-row="1" data-index="3">
</div>
<div id="feedback1" class="feedback"></div>

<!-- Question 2 -->
<p class="lesson-subtitle">Which flowers are NOT similar in texture? Select 2</p>
<div class="row justify-content-center mb-2" id="row2">
  <img src="{{ url_for('static', filename='images/astilbe.webp') }}" class="selectable-img mx-1" data-row="2" data-index="0">
  <img src="{{ url_for('static', filename='images/babys-breath.png') }}" class="selectable-img mx-1" data-row="2" data-index="1">
  <img src="{{ url_for('static', filename='images/statice.webp') }}" class="selectable-img mx-1" data-row="2" data-index="2">
  <img src="{{ url_for('static', filename='images/Lilly.png') }}" class="selectable-img mx-1" data-row="2" data-index="3">
  <img src="{{ url_for('static', filename='images/craspedia.webp') }}" class="selectable-img mx-1" data-row="2" data-index="4">
</div>
<div id="feedback2" class="feedback"></div>

<!-- Check button -->
<div class="text-center mt-3" style="font-family: Indie Flower, sans-serif">
  <button class="btn btn-success" id="check-btn">Check</button>
</div>

<!-- Navigation -->
<div class="back_next mt-4">
  <div class="row justify-content-between">
    <div class="col-auto">
      <a href="/buildit_quiz1" class="btn btn-outline-primary">Previous Question</a>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary" id="next-btn" disabled onclick="window.location.href='/assemble'">Next Question</button>
    </div>
  </div>
</div>

<script>
  const selectedRow1 = [];
  const selectedRow2 = [];
  let hasSubmitted = false;

  document.querySelectorAll('.selectable-img').forEach(img => {
    img.addEventListener('click', () => {
      if (hasSubmitted) return;

      const row = img.dataset.row;
      const index = parseInt(img.dataset.index);
      const selected = row === '1' ? selectedRow1 : selectedRow2;

      if (row === '1') {
        selectedRow1.length = 0;
        document.querySelectorAll('[data-row="1"]').forEach(el => el.classList.remove('selected'));
        selectedRow1.push(index);
        img.classList.add('selected');
      } else {
        if (selected.includes(index)) {
          selected.splice(selected.indexOf(index), 1);
          img.classList.remove('selected');
        } else if (selected.length < 2) {
          selected.push(index);
          img.classList.add('selected');
        }
      }
    });
  });

  document.getElementById('check-btn').addEventListener('click', () => {
    if (hasSubmitted) return;

    const fb1 = document.getElementById('feedback1');
    const fb2 = document.getElementById('feedback2');
    fb1.classList.remove('correct', 'incorrect');
    fb2.classList.remove('correct', 'incorrect');

    const q1Correct = selectedRow1.length === 1 && selectedRow1[0] === 0;
    const q2Correct = selectedRow2.length === 2 && selectedRow2.includes(3) && selectedRow2.includes(4);

    fb1.textContent = q1Correct
      ? 'Correct! Both of these flowers are soft, rounded, and lush.'
      : 'Not Quite! The rose is soft, rounded, and lush — the correct answer is the first flower.';
    fb1.classList.add(q1Correct ? 'correct' : 'incorrect');

    fb2.textContent = q2Correct
      ? 'Correct! Both of these flowers are not airy, wispy, and light like the rest.'
      : 'Not Quite! The correct answers are the last two flowers — they are not airy, wispy, and light like the rest.';
    fb2.classList.add(q2Correct ? 'correct' : 'incorrect');

    hasSubmitted = true;
    document.getElementById('check-btn').disabled = true;

    // Send correctness to Flask
    fetch('/submit_quiz2', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        q1_correct: q1Correct,
        q2_correct: q2Correct
      })
    });

    document.getElementById('next-btn').disabled = false;
  });
</script>
{% endblock %}
